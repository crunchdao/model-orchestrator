{
  "id": "e303d721",
  "title": "[P1] Guard against empty node_name producing invalid URL after provisioning",
  "tags": [
    "pr-3",
    "bug",
    "p1",
    "phala"
  ],
  "status": "done",
  "created_at": "2026-02-16T10:16:41.730Z"
}

**File:** `model_orchestrator/infrastructure/phala/_cluster.py`

**Changes made:**

1. **`_get_node_name()` now fetches a single CVM by ID** — calls `/api/v1/cvms/{app_id}` instead of listing all CVMs and iterating. More efficient and avoids loading the full CVM list.

2. **Early guard for empty `node_name`** — after `_get_node_name()`, if the result is empty, raises `PhalaClusterError` immediately instead of spending 3 minutes health-checking an invalid URL.

**Tests added** in `tests/test_phala_cluster.py` (`TestGetNodeName`):
- `test_fetches_single_cvm_by_id` — verifies correct endpoint is called and node_name extracted
- `test_returns_empty_on_missing_node_info` — missing `node_info` returns `""`
- `test_returns_empty_on_api_error` — API failure returns `""`
