{
  "id": "f1d27da9",
  "title": "[P2] registry_cvm.node_name may be empty — broken REGISTRY_URL passed to new runner",
  "tags": [
    "pr-3",
    "bug",
    "p2",
    "phala"
  ],
  "status": "open",
  "created_at": "2026-02-16T10:54:30.655Z"
}

**File:** `model_orchestrator/infrastructure/phala/_cluster.py`, line 481

If the registry CVM was discovered via fallback URLs, `node_name` defaults to `""`. The constructed `registry_url` becomes `https://<app_id>-9010.dstack-pha-.phala.network` — an invalid URL passed as `REGISTRY_URL` env var to the newly provisioned runner. The runner would start with a broken registry endpoint.

**Fix:** Guard for empty `node_name` on the registry CVM before constructing the URL:

```python
if not registry_cvm.node_name:
    raise PhalaClusterError(
        f"Registry CVM {registry_cvm.name} has no node_name — cannot construct REGISTRY_URL"
    )
```
