{
  "id": "455ae193",
  "title": "[P1] Fix KeyError crash on missing task_id in model adoption flow (general, not Phala-specific)",
  "tags": [
    "pr-3",
    "bug",
    "p1",
    "general"
  ],
  "status": "wontfix",
  "created_at": "2026-02-16T10:16:33.660Z"
}

**File:** `model_orchestrator/services/model_runs/model_runs.py`, line 175

`check_already_running` returns the raw dict from the spawntee `/running_models` API. If that dict doesn't contain a `"task_id"` key, `already_running["task_id"]` crashes with `KeyError`. The `_builder.py` implementation explicitly handles the `task_id`-missing case with `rm.get("task_id")` but still returns the `rm` dict regardless.

**Fix:** Use `.get("task_id")` and fall back to `run_service.run_model()` if missing:

```python
task_id = already_running.get("task_id")
if not task_id:
    get_logger().warning("Model %s running but has no task_id â€” rebuilding", model.model_id)
    return self.run_service.run_model(model, crunch)
```
