services:
  spawn-service:
    image: borisndocker/crunch-tee-spawn:0.8.43
    container_name: spawn-service-1
    privileged: true
    ports:
      - "9010:8080"
      - "50001:50001"
      - "50002:50002"
      - "50003:50003"
      - "50004:50004"
      - "50005:50005"
      - "50006:50006"
      - "50007:50007"
      - "50008:50008"
      - "50009:50009"
      - "50010:50010"
      - "50011:50011"
      - "50012:50012"
      - "50013:50013"
      - "50014:50014"
      - "50015:50015"
      - "50016:50016"
      - "50017:50017"
      - "50018:50018"
      - "50019:50019"
      - "50020:50020"
      - "50021:50021"
      - "50022:50022"
      - "50023:50023"
      - "50024:50024"
      - "50025:50025"
      - "50026:50026"
      - "50027:50027"
      - "50028:50028"
      - "50029:50029"
      - "50030:50030"
      - "50031:50031"
      - "50032:50032"
      - "50033:50033"
      - "50034:50034"
      - "50035:50035"
      - "50036:50036"
      - "50037:50037"
      - "50038:50038"
      - "50039:50039"
      - "50040:50040"
      - "50041:50041"
      - "50042:50042"
      - "50043:50043"
      - "50044:50044"
      - "50045:50045"
      - "50046:50046"
      - "50047:50047"
      - "50048:50048"
      - "50049:50049"
      - "50050:50050"
      - "50051:50051"
      - "50052:50052"
      - "50053:50053"
      - "50054:50054"
      - "50055:50055"
      - "50056:50056"
      - "50057:50057"
      - "50058:50058"
      - "50059:50059"
      - "50060:50060"
      - "50061:50061"
      - "50062:50062"
      - "50063:50063"
      - "50064:50064"
      - "50065:50065"
      - "50066:50066"
      - "50067:50067"
      - "50068:50068"
      - "50069:50069"
      - "50070:50070"
      - "50071:50071"
      - "50072:50072"
      - "50073:50073"
      - "50074:50074"
      - "50075:50075"
      - "50076:50076"
      - "50077:50077"
      - "50078:50078"
      - "50079:50079"
      - "50080:50080"
      - "50081:50081"
      - "50082:50082"
      - "50083:50083"
      - "50084:50084"
      - "50085:50085"
      - "50086:50086"
      - "50087:50087"
      - "50088:50088"
      - "50089:50089"
      - "50090:50090"
      - "50091:50091"
      - "50092:50092"
      - "50093:50093"
      - "50094:50094"
      - "50095:50095"
      - "50096:50096"
      - "50097:50097"
      - "50098:50098"
      - "50099:50099"
      - "50100:50100"
      - "50101:50101"
      - "50102:50102"
      - "50103:50103"
    environment:
      - LOG_LEVEL=INFO
      - DEBUG_MODE=true
      - MODE=${MODE:-registry+runner}
      - CAPACITY_THRESHOLD=${CAPACITY_THRESHOLD:-0.8}
      - APPROVED_COMPOSE_HASH=${APPROVED_COMPOSE_HASH:-}
      - REGISTRY_URL=${REGISTRY_URL:-}
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_REGION=${AWS_REGION:-eu-west-1}
      - CVM_BASE_DOMAIN=${CVM_BASE_DOMAIN:-dstack-pha-prod10.phala.network}
    volumes:
      - /var/run/tappd.sock:/var/run/tappd.sock
      - /var/run/dstack.sock:/var/run/dstack.sock
      - spawntee-tasks:/opt/spawntee-tasks

  alpine-ttypd:
    image: hackinglab/alpine-ttyd-bash:3.2
    environment:
      - AUTHOR=e1
      - HL_USER_USERNAME=root
      - HL_USER_PASSWORD=123QWEasd
    ports:
      - 7681:7681
    volumes:
      - /:/host
    network_mode: host

volumes:
  spawntee-tasks:
    driver: local